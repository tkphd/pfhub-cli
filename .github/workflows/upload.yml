name: PFHub Upload
on:
  issues:
    types: [opened]
jobs:
  pfhub-upload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: stefanbuck/github-issue-parser@v2
        id: issue-parser
        with:
          template-path: .github/ISSUE_TEMPLATE/upload.yml
      - run: |
          echo '${{ steps.issue-parser.outputs.jsonString }}' | yq -P | yq eval-all '
            select(fileIndex=0).benchmark.id = select(fileIndex=1).benchmark_id |
            select(fileIndex=0).metadata.implementation.repo.url = select(fileIndex=1).repo |
            select(fileIndex=0).metadata.summary = select(fileIndex=1).summary |
            select(fileIndex=0).metadata.implementation.name = select(fileIndex=1).code
          ' _data/blank.yaml - | yq -s '"file_" + $index'
      - run: cat file_0.yml
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: upload xxx
          body: adding upload from issue xxx
          branch: upload
